{% extends "prologin/base.html" %}
{% load i18n %}
{% load bootstrap django_bootstrap_breadcrumbs crispy_forms_tags %}

{% block breadcrumbs %}
  {{ block.super }}
  {% breadcrumb_for "#TODO" %}{% trans "Members" %}{% endbreadcrumb_for %}
  {% breadcrumb edited_user "users:profile" edited_user.id %}
  {% breadcrumb_for "" %}{% trans "Edit" %}{% endbreadcrumb_for %}
{% endblock breadcrumbs %}

{% block title %}{% blocktrans with edited_user.username as username %}Editing {{ username }}'s profile{% endblocktrans %}{% endblock %}

{% block content %}
<h1>{% blocktrans with edited_user.username as username %}Editing {{ username }}'s profile{% endblocktrans %}</h1>

{% include "users/as_staff_warning.html" %}

<p class="pull-right"><a href="{% url 'users:edit_password' edited_user.pk %}" class="btn btn-default"><i class="fa fa-key"></i> {% trans "Change password" %}</a></p>
<p>{% trans "Don't forget to click “Save” at the bottom when you are done making changes." %}</p>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {% crispy form %}
  <small>Je consens au traitement de mes données personnelles ci-dessus par Prologin.</small> 
  <button class="btn btn-primary btn-block" type="submit"><i class="fa fa-save"></i> {% trans "Save" %}</button>
    <p class="help-block ">
      Prologin est organisés par l'association Prologin, qui agit en tant que contrôleur de données. Les réponses collectées dans ce formulaire nous permettent de fournir les services (communication et juge en ligne) et préparer le concours : sélections, restrictions alimentaires, etc...
Pour en apprendre plus à propos de notre gestion des données et de vos droits, consultez 
      <a href="{% url 'pages:about-privacy-policy' %}">notre page dédiée.</a>
    </p>
</form>

{% endblock %}

{% block extra_script %}
  {{ block.super }}
  <script>
    let formGroupIds = ["id_picture", "id_avatar"];

    formGroupIds.forEach(function (id) {
      let form = $("#div_" + id);

      if (form != null) {
        $("#" + id).change(function (e) {
          // if FileReader is supported and files isn't empty
          if (FileReader && this.files.length > 0) {
            let fr = new FileReader();
            fr.onload = function () {
              $("#div_" + id + " img")[0].src = fr.result;
            };
            fr.readAsDataURL(this.files[0]);
          }
        });
      }
    });
  </script>
{% endblock %}
