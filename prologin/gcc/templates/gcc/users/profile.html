{% extends "gcc/base.html" %}
{% load static %}
{% load utils %}
{% load i18n staticfiles rules %}
{% block title %}GCC! − Inscription{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'vendor/bootstrap/dist/css/bootstrap.min.css' %}" />
{% endblock %}
{% block content %}
<section class="wrapper">
    <div class="container">
        <div class="bootstrap_region">
            {% trans "<em>not provided</em>" as noinfo %}
            {% if see_private %}
            <a href="{% url 'gcc:edit' shown_user.id %}" class="btn btn-default pull-right">
            <i class="fa fa-pencil"></i> {% trans "Edit profile" %}</a>
            {% endif %}
            <h1>{{ shown_user.username }}</h1>
            <div class="row">
                <div class="col-sm-4 col-md-3">
                    <div class="avatar-container avatar-container-profile" title="{% blocktrans with shown_user.username as username %}{{ username }}'s profile picture{% endblocktrans %}" {% if shown_user.avatar %}style="background-image: url({{ shown_user.avatar.url }})" {% endif %}>
                        {% if shown_user.picture %}
                        <div class="avatar-container avatar-container-round" style="background-image: url({{ shown_user.picture.url }})" title="{% blocktrans with shown_user.username as username %}{{ username }}'s staff picture{% endblocktrans %}"></div>
                        {% endif %}
                    </div>
                    <ul class="fa-ul text-break-word profile-info" style="margin-bottom: 1em">
                        {% if see_private %}
                        {% if shown_user.get_full_name %}
                        <li title="{% trans " Full name" %}">
                            <i class="fa fa-li fa-user"></i>
                            <span class="text-capitalize">{{ shown_user.first_name }}</span>
                            <span class="text-smallcaps">{{ shown_user.last_name }}</span>
                        </li>
                        {% endif %}
                        {% if shown_user.phone %}
                        <li title="{% trans " Phone number" %}">
                            <i class="fa fa-li fa-phone"></i>
                            <a href="tel:{{ shown_user.phone }}">{{ shown_user.phone|phone_number }}</a>
                        </li>
                        {% endif %}
                        {% if shown_user.email %}
                        <li title="{% trans " Email address" %}">
                            <i class="fa fa-li fa-envelope-o"></i>
                            <a href="email:{{ shown_user.email }}">{{ shown_user.email }}</a>
                        </li>
                        {% endif %}
                        {% if shown_user.birthday %}
                        <li title="{% trans " Birth day" %}"><i class="fa fa-li fa-birthday-cake"></i>
                            {{ shown_user.birthday }}<br>
                            <small class="text-muted">{{ shown_user.birthday|timesince }}</small>
                        </li>
                        {% endif %}
                        {% if user.has_partial_address %}
                        <li title="{% trans " Postal address" %}">
                            <i class="fa fa-li fa-map-marker"></i>
                            <address>
                                {{ shown_user.address|linebreaksbr }}<br>
                                {{ shown_user.postal_code }} {{ shown_user.city }}<br>
                                {{ shown_user.country }}
                            </address>
                        </li>
                        {% endif %}
                        {% endif %}
                        <li title="{% trans " Date joined" %}">
                            <i class="fa fa-li fa-clock-o"></i>
                            {% trans "Member for" %} {{ shown_user.date_joined|timesince }}
                        </li>
                    </ul>
                </div>
                <div class="col-sm-8 col-md-5 compact-headings">
                    <h3>{% trans "Applications" %}</h3>
                    {% if not has_applied_to_current %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <table class="panel-title">
                                <tbody>
                                    <tr>
                                        <td width="100%">Edition {{last_edition}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="panel-body">
                            <table class="panel-title">
                                <tbody>
                                    <tr>
                                        <td width="100%">
                                            <p> {% trans "Sadly you did not applied yet for the curent edition..." %} </p>
                                        </td>
                                        <td class="text-right">
                                            <a  href="{% url 'gcc:application_form' edition=last_edition %}"
                                            class="btn btn-default btn-xs">
                       <i class="fa fa-pencil"></i> {% trans "Apply" %}</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                    {% for applicant in applications %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <table class="panel-title">
                                <tbody>
                                    <tr>
                                        <td width="100%">Edition {{applicant.edition}}</td>
                                        {% if applicant.edition.subscription_is_open %}
                                        <td class="text-right">
                                            <a  href="{% url 'gcc:application_form' edition=applicant.edition %}"
                                                class="btn btn-default btn-xs">
                           <i class="fa fa-pencil"></i> {% trans "Edit application" %}</a>
                                        </td>
                                        {% endif %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="panel-body">
                            {% if applicant.status == 0 %}
                            <span class="badge badge-warning">{% trans "Pending" %} </span>
                            {% endif %}
                            {% if applicant.status == 1 %}
                            <span class="badge badge-danger">{% trans "Rejected" %} </span>
                            {% endif %}
                            {% if applicant.status == 2 %}
                            <span class="badge badge-success">{% trans "Selected" %} </span>
                            <p> {% trans "You will soon receive your assignation." %} </p>
                            {% endif %}
                            {% if applicant.status == 3 %}
                            <span class="badge badge-warning">{% trans "Accepted" %} </span>
                            <p> {% trans "You have been assigned to:" %} </p>
                            <ul>
                                {% for event in applicant.list_of_assignation_event %}
                                <li> {{event.short_description}} </li>
                                {% endfor %}
                            </ul>
                            <p> {% trans "Please confirm your venue." %} </p>
                            {% endif %}
                            {% if applicant.status == 4 %}
                            <span class="badge badge-success">{% trans "Confirmed" %} </span>
                            <p> {% trans "You have been assigned to:" %} </p>
                            <ul>
                                {% for event in applicant.list_of_assignation_event %}
                                <li> {{event.short_description}} </li>
                                {% endfor %}
                            </ul>
                            <p>{% trans "And you confirmed your venue, see you there!" %} </p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="col-sm-12 col-md-4 compact-headings">
                    {% with shown_author.entries_published.all as entries_published %}
                    {% if entries_published %}
                    <h3>{% trans "Latest authored news entries" %}</h3>
                    <ul class="nav nav-stacked">
                        {% for entry in entries_published|slice:":5" %}
                        <li><a href="{{ entry.get_absolute_url }}">
                        <span class="text-muted">{{ entry.creation_date|date:"DATE_FORMAT" }} ⋅</span> {{ entry.title }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    {% endwith %}
                    {% with shown_user.team_memberships.all as team_memberships %}
                    {% if team_memberships %}
                    <h3>{% trans "Staff roles" %}</h3>
                    {% spaceless %}{% for membership in team_memberships|dictsortreversed:'year' %}
                    <a href="{% url 'team:year' membership.year %}#m{{ shown_user.pk }}"
                       class="btn btn-default staff-flair staff-flair-{{ membership.role.name|slugify }}">
                      {% blocktrans with year=membership.year role=membership.role_name %}{{ year }} ⋅
                        {{ role }}{% endblocktrans %}</a>
                    {% endfor %}{% endspaceless %}
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
            {% if shown_user.id == user.id or see_private %}
            <div class="panel panel-info" style="margin-top: 1em">
                <div class="panel-heading">
                    <h3 class="panel-title"> {% trans "Account management" %}</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-noborder table-align-middle">
                        <tbody>
                            <tr>
                                <td>
                                    <a href="{% url 'users:takeout' shown_user.id %}"
                       class="btn btn-block btn-info">
                      <i class="fa fa-download"></i>
                      {% trans "Export your personal data" %}
                    </a>
                                </td>
                                <td>
                                    {% blocktrans %}
                                    You can download an archive containing all your personal data, as
                                    provided by your Right to data portability (Art. 20 of GDPR).
                                    {% endblocktrans %}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <a
                       {% if view.can_edit_profile %}
                         href="{% url 'gcc:delete' shown_user.id %}"
                         class="btn btn-block btn-danger"
                       {% else %}
                         href="#"
                         class="btn btn-block btn-danger disabled"
                       {% endif %}
                    >
                      <i class="fa fa-exclamation-triangle"></i>
                      {% trans "Delete your account" %}
                    </a>
                                </td>
                                <td {% if not view.can_edit_profile %}class="text-muted" {% endif %}>
                                    {% blocktrans %}
                                    You can delete your account and all associated personal data, as
                                    provided by your Right to erasure (Art. 17 of GDPR).
                                    {% endblocktrans %}
                                    {% if not view.can_edit_profile %}
                                    <strong>{% blocktrans %}
                      You cannot delete your account while participating to the
                      contest. If needed, contact the staff.
                    {% endblocktrans %}</strong>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}